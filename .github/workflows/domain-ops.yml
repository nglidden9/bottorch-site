jobs:
  guard-forbidden-data:
    name: Guard: forbid placeholders/simulated data
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Detect changed files
        run: |
          if [ "${{ github.event_name }}" = "pull_request" ]; then
            git fetch origin ${{ github.base_ref }} --depth=100
            git diff --name-only origin/${{ github.base_ref }}...HEAD > changed.txt || true
          else
            git diff --name-only HEAD~1 HEAD > changed.txt || true
          fi

      - name: Scan for forbidden phrases (case-insensitive)
        run: |
          if grep -i -E "placeholder|simulated data" changed.txt; then
            echo "❌ Forbidden placeholder/simulated data found."
            exit 1
          else
            echo "✅ No forbidden phrases detected."
          fi
